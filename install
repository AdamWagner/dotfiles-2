#!/usr/bin/env bash

set -e

BREW_DIR="$HOME/.brew"
REPOS_DIR="$HOME/.homesick/repos"
HOMESHICK_DIR="$REPOS_DIR/homeshick"
DOTFILES_DIR="$REPOS_DIR/dotfiles"

# make sure brew is in the path
export PATH="$BREW_DIR/bin:$PATH"
export MANPATH="$BREW_DIR/share/man:$MANPATH"
export INFOPATH="$BREW_DIR/share/info:$INFOPATH"

# infer OS and install homebrew
if [ "$(uname -s)" = 'Darwin' ] ; then
  osx=true
  which brew &>/dev/null || git clone https://github.com/Homebrew/homebrew.git "$BREW_DIR"
else
  echo 'Unsupported OS!' >&2
  exit 1
fi

# install third-parties
brew doctor
brew update
brew install ag ctags fswatch gawk git htop node nvm python python3 tmux z zsh
brew tap neovim/neovim && brew install --head neovim
$osx && brew install macvim
brew cask install caskroom/fonts/font-hack

# set default shell
chsh -s "$(which zsh)"

# install homeshick
[ -d "$HOMESHICK_DIR" ] || git clone https://github.com/andsens/homeshick.git "$HOMESHICK_DIR"
source "$HOMESHICK_DIR/homeshick.sh"

# install dotfiles
[ -d "$DOTFILES_DIR" ] || (
  homeshick clone https://github.com/aymericbeaumet/dotfiles.git
  homeshick link dotfiles
)

echo 'Installation finished!'

exit 0
