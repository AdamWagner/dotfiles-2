#!/usr/bin/env bash

set -e

# install brew
BREW_DIR="$HOME/.brew"
export PATH="$BREW_DIR/bin:$PATH"
export MANPATH="$BREW_DIR/share/man:$MANPATH"
export INFOPATH="$BREW_DIR/share/info:$INFOPATH"
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

# install third-parties
brew doctor
brew tap neovim/neovim rogual/neovim-dot-app
brew update
brew reinstall ag ctags fswatch gawk git git-extras htop jq node nvm python python3 tmux z zsh
brew reinstall --HEAD vim neovim macvim neovim-dot-app
brew cask reinstall caskroom/fonts/font-hack
chsh -s "$(which zsh)"

# install homeshick and dotfiles
HOMESHICK_DIR="$HOME/.homeshick/repos/homeshick"
[ -d "$HOMESHICK_DIR" ] || (
  git clone https://github.com/andsens/homeshick.git "$HOMESHICK_DIR"
)
source "$HOMESHICK_DIR/homeshick.sh"
DOTFILES_DIR="$(dirname $HOMESHICK_DIR)/dotfiles"
[ -d "$DOTFILES_DIR" ] || (
  homeshick clone https://github.com/aymericbeaumet/dotfiles.git
  homeshick link dotfiles
)

echo 'Installation finished!'

exit 0
